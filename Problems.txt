2022.4.20-


# 存在的问题
	*动态更新HiC热图
		Method:
			1. 根据`.assembly` 重新生成`.hic`

	如何精确位置信息，寻找需要插入的位置

	.hic 文件中的序列长度和 .assembly文件中的序列长度不一致，
	当Juicer中导入`.assembly`文件后，显示的序列长度和组装基因组的长度一致，猜测其中可能存在缩放映射
	

	滑动可视化 + 图片位点(对应序列信息) + 如果获取调整后的hic热图 + Matrix > PNG


	如何确定每次遍历上错误的位置与contig的对应关系
		根据错误的位置 + `.assembly中序列总长度推断contig的位置`

	错误的大小不确定
		预先设置一个大小，提供一个参数给用户选择

	Contact Matrix 的数值规律
		loop 区域周围值的大小问题
		能否直接修改矩阵 + 矩阵太大的操作问题
		直接操作矩阵 + 不能确定规律是否通用（loop区域等）



# 已解决问题
	步长
		生成训练数据集时，步长可以小一点
		实际运用时，步长和区域范围，根据染色体的最大长度来定

	看下 .hic 与 .assembly 染色体对应关系
		有一定的对应关系，但是精确度不够,可能相差1个contig左右

	线粒体与叶绿体染色体是纳入考虑范围
		v1.0 先仅针对动物基因组

	依旧走Juicer流程，暂时不考虑HiC-Pro等

	`inter.hic` 不能直接可视化，导入Juicer中会出现错误

	`.hic`文件可以根据hicConvertFormat转换至各种格式

	Juicebox 中原始图像序列（draft genome）与 .assembly 的位置关系
		juice热图上方序列位置与 .assembly中 contig的关系
		上方仅是序列长度的叠加，.assenmly中的序列，目前顺序关系还没有确定
		，基本上与genome.fasta中序列暂无顺序关系，图像中的Contig有顺序。
		详见图片


	染色体边界的添加
		只要确定染色体边界的序号，可以修改染色体边界，染色体内是由Contig
		组成的,只要确定染色体内所包含的Contig序号和方向，即可手动添加


	测试手动操作.assembly 并导入juicebox中可视化查看
		可以手动操作，.assembly文件需要和.hic文件一致，不然后出现边界框不匹配的情况，
		主要规律看MarkDown文件中的内容

	TAD:拓扑关联结构域简介
		https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3356448/
		directionality index统计量

		使用TADbit识别拓扑关联结构域
		https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5540598/

	chromatin loops:染色质环简介
		https://www.cell.com/fulltext/S0092-8674(14)01497-401497-4)
		染色质环鉴定

	有关TAD和loop的深度学习识别，已有发表的文献

	论文中增加对于参数讨论的部分，体现思考范围与工作量



# 参数设计
	测试不同分辨率下的，最大长宽
		最大长宽 = 分辨率 × 1444

		建议Juicer流程中，分辨率从 2.5Mb(1.25Mb) > 500bp
			最大可画 1.25Gb 的染色体范围


	低分辨率检测错误，高分辨率定位错误

	异步处理 加快处理速度

	错误检测分类模块
		根据错误分类和检测模型，检测出HiC中可能出现的错误，输出到文件，便于用户快速定位错误（在Juice中查找）

	调整错误模块
		根据错误检测模块中，检索的错误，调整HiC

	两个单独的命令行脚本，一个仅用于数据推断和训练，一个结合流程实现修改hic数据


	指定滑动窗口的大小（既分辨率）
		参数可以单独 | 范围


	精确错误边界位置，采用2分快速迭代，并设置边界阈值（根据）


	有错误，无法解决，缺失数据或者其他原因



# 初步方案
	基于Juicer
		根据.hic文件生成热图
		
		高分辨率下
			错误类型
				MISJOINS
					深度学习识别错误区域，切割contig
				易位
					深度学习识别发生易位区域并定位，根据大致定位，在互作矩阵中寻找需要调整的位置
				翻转（蝴蝶）
					深度学习识别蝴蝶区域并定位，根据大致定位，在互作矩阵中寻找需要调整的位置
						利用寻找loop的思想，找到蝴蝶的翅膀边缘即可确定调整的位置

				冗余位置
					默认调整到调整到最后

			滑动窗口 > 遍历整个热图，实时更新热图，一轮遍历完后，检查一遍

		低分辨率下
			确定染色体边界
				深度学习识别染色体边界并定位，根据大致定位，在互作矩阵中寻找准确的染色体边界

		根据以上内容，修改.assembly文件 

		run-asm-pipeline-post-review.sh -r genome.review.assembly genome.fa aligned/merged_nodups.txt > 最终文件






